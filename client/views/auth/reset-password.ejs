<link
  rel="shortcut icon"
  href="./img/Black White Minimalist Professional Initial Logo.png"
  type="image/x-icon"
/>
<link rel="stylesheet" href="/mystyle.css" />
<div class="auth-container">
  <h2 class="text-center mb-4">Reset Password</h2>

  <!-- Flash Messages -->
  <% if (typeof success_msg !== 'undefined' && success_msg.length > 0) { %>
  <div class="alert alert-success" role="alert"><%= success_msg %></div>
  <% } %> <% if (typeof error_msg !== 'undefined' && error_msg.length > 0) { %>
  <div class="alert alert-danger" role="alert"><%= error_msg %></div>
  <% } %>

  <form action="/auth/reset-password" method="POST">
    <input type="hidden" name="token" value="<%= token %>" />
    <div class="mb-3">
      <label for="password" class="form-label">New Password</label>
      <input
        type="password"
        class="form-control"
        id="password"
        name="password"
        placeholder="Enter new password (min 6 characters)"
        minlength="6"
        required
      />
      <% if (typeof errors !== 'undefined' && errors.password) { %>
      <div class="error-message"><%= errors.password %></div>
      <% } %>
    </div>
    <div class="mb-3">
      <label for="confirmPassword" class="form-label"
        >Confirm New Password</label
      >
      <input
        type="password"
        class="form-control"
        id="confirmPassword"
        name="confirmPassword"
        placeholder="Confirm your new password"
        minlength="6"
        required
      />
      <% if (typeof errors !== 'undefined' && errors.confirmPassword) { %>
      <div class="error-message"><%= errors.confirmPassword %></div>
      <% } %>
    </div>
    <button type="submit" class="btn btn-primary w-100">Update Password</button>
  </form>

  <div class="text-center mt-3">
    <p><a href="/auth/signin">Back to Sign In</a></p>
    <p><a href="/auth/forgot-password">Request New Reset Link</a></p>
  </div>
</div>

<script>
  // Enhanced password confirmation validation
  document.querySelector("form").addEventListener("submit", function (e) {
    const password = document.getElementById("password").value;
    const confirmPassword = document.getElementById("confirmPassword").value;

    if (password !== confirmPassword) {
      e.preventDefault();
      alert(
        "Passwords do not match! Please make sure both passwords are identical."
      );
      return false;
    }

    if (password.length < 6) {
      e.preventDefault();
      alert("Password must be at least 6 characters long.");
      return false;
    }
  });

  // Real-time password matching indicator
  document
    .getElementById("confirmPassword")
    .addEventListener("input", function () {
      const password = document.getElementById("password").value;
      const confirmPassword = this.value;
      const button = document.querySelector("button[type='submit']");

      if (confirmPassword.length > 0) {
        if (password === confirmPassword) {
          this.style.borderColor = "#28a745";
          button.disabled = false;
        } else {
          this.style.borderColor = "#dc3545";
          button.disabled = true;
        }
      } else {
        this.style.borderColor = "";
        button.disabled = false;
      }
    });
</script>
